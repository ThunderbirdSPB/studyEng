<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="..\common\dropDef.css">
    <link rel="stylesheet" href="..\common\header.css">
    <link rel="stylesheet" href="signIn.css">
<!--    <script src="SignIn.js"></script>-->
</head>
<body>
    <header>
        <div class="header">
            <ul class="header-ul">
                <a class="header-a" href="grammar.html"><li>Грамматика</li></a>
                <a class="header-a" href="dictionary/dictionary.html"><li>Словарь</li></a>
                <a class="header-a" href="grammar.html"><li>Тренировки</li></a>
                <a class="header-a" href="grammar.html"><li>Контент</li></a>
            </ul>

            <img class="profile-pic" src="..\images\user_pic.png" >
        </div>
    </header>

    <div class="sign-in-container">
        <div class="si-form">
            <div class="sign-in">
                <span>
                    Войти
                </span>
            </div>
            <div class="si-input">
                <input id="mail" type="text" name="mail" placeholder="Введите email" autofocus required>
                <input id="pass" type="password" name="password" placeholder="Введите пароль" required>
                <button onclick="asyncSignIn()">
                    Войти
                </button>
            </div>

            <div class="sign-up">
                <span>
                    Еще нет аккаунта?
                </span>
                <button>
                    <a href="SignUp.html">Зарегистрироваться</a>
                </button>
            </div>
        </div>
    </div>

<script>
    async function asyncSignIn() {
        const URL = "http://localhost:8080/signIn";
        let mail = document.getElementById("mail").value;
        let pass = document.getElementById("pass").value;

        // if (!isValid(mail, name, pass)){
        //     alert("Invalid data");
        //     return ;
        // }

        let response = await fetch(URL,{
            method: 'POST',
            headers:{
                'mail': mail,
                'password': pass
            }
        });

        //По идее не должно произойти, т.к. данные перед отправкой проверяются
        if (!response.ok){
            alert("Smt wrong");
            return ;
        }

        do{
            await new Promise(resolve => setTimeout(resolve, 10));
            response = await fetch(URL,{
                method: 'POST',
                headers:{
                    'handling':'true'
                }
            });
        }while(response.headers.get("ready") === "false");

        if (response.status === 400)
            alert("Wrong data");

        if (response.ok) {
            window.location.href = "http://localhost:8080/dictionary/dictionary.html";
        }
    }

    // function isValid(mail, pass) {
    //     if (pass.left === 0 || pass.length > 30)
    //         return false;
    //
    //     if(mail.length === 0 || mail.length > 64)
    //         return false;
    //
    //     let re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    //     return re.test(String(mail).toLowerCase());
    // }
</script>
</body>
</html>